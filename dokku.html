<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>dokku</title>
<meta name="generator" content="Org Mode" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
<meta property="og:title" content="dokku">
<meta property="og:description" content="">
<meta property="og:image" content="https://notes.neeasade.net/assets/posts/ca_dump3/bc026a292c7bf0564a4cdaae51ac26474bdc4a89f5a09cc4d2d46a5a08928552.png">
<meta property="og:url" content="https://notes.neeasade.net/dokku">
<meta property="description" content="">
<meta name="twitter:card" content="summary">
<script src="./assets/js/linktext.js" defer></script>
<style> body {background: url("./assets/posts/ca_dump3/bc026a292c7bf0564a4cdaae51ac26474bdc4a89f5a09cc4d2d46a5a08928552.png") repeat;} </style>
<style> body {background-size: auto 360px !important; } </style>
<script src=".//assets/js/copy.js" defer></script>
<script data-goatcounter="https://neeasade.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
<script src="//instant.page/5.1.0" type="module" integrity="sha384-by67kQnR+pyfy8yWP4kPO12fHKRLHZPfEsiSXR8u2IKcTdxD805MGUXBzVPnkLHw"></script>
<link rel='stylesheet' href='./assets/css/colors.css?sum=cbc7f86dcba5597749ac3221baabf396'>
<link rel='stylesheet' href='./assets/css/normalize.css?sum=112272e51c80ffe5bd01becd2ce7d656'>
<link rel='stylesheet' href='./assets/css/magick.css?sum=2ca97ca19bc03ef9dd1d6b45d109ec3a'>
<link rel='stylesheet' href='./assets/css/notes.css?sum=5146fda5bafcad0a7993df2ca8e83f58'>
</head>
<body>
<main id="content" class="content">
<header>
<div style="float: left">
    <a href='./index.html'>../notes</a>
</div>

<div style="float: right">
    
    
    <a href="https://raw.githubusercontent.com/neeasade/neeasade.github.io/source/posts/dokku.org">source</a>
</div>
<h1 class=title>
    <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
        <rect x="5" y="15" width="20" height="20" fill="none" stroke="#444748" stroke-width="2"/>
        <rect x="14" y="6" width="20" height="20" fill="none" stroke="#444748" stroke-width="2"/>
    </svg>
    dokku
    <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
        <rect x="5" y="15" width="20" height="20" fill="none" stroke="#444748" stroke-width="2"/>
        <rect x="14" y="6" width="20" height="20" fill="none" stroke="#444748" stroke-width="2"/>
    </svg>
</h1>
<div class="org-center">
<p>

</p>
</div>
<span class=pubinfo>
    Published 2025-07-22,
    last edit <a href="https://github.com/neeasade/neeasade.github.io/commits/source/posts/dokku.org">2025-08-12</a>
</span>
<div class="posttags"> <a href='./tag-clojure.html'>#clojure</a> </div>
</header>
<hr>
<p>
<a href="https://dokku.com/">dokku</a> is a PaaS (&ldquo;platform as a service&rdquo; or heroku-like) I&rsquo;d heard about off and
on over the years, but awhile back I got the chance to use it and it <i>just
worked</i> so hard I completely forgot about it, even though it&rsquo;s been running for
a year.
</p>

<p>
It looks like I took notes at the time on the setup (on a debian box hosted on
vultr) - named the &ldquo;app&rdquo; muffin, after my cat:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #c6007f;">domain</span>=app.neeasade.net
<span style="color: #c6007f;">app_name</span>=muffin

<span style="color: #6a6d6e;"># </span><span style="color: #6a6d6e;">on server</span>
wget -NP . https://dokku.com/install/v0.35.7/bootstrap.sh
sudo <span style="color: #c6007f;">DOKKU_TAG</span>=v0.35.7 bash bootstrap.sh
dokku domains:set-global <span style="color: #007c00;">"$domain"</span>
cat ~/.ssh/authorized_keys | dokku ssh-keys:add admin
dokku apps:create <span style="color: #007c00;">'$app_name'</span>
<span style="color: #6a6d6e;"># </span><span style="color: #6a6d6e;">don't forget to open ports: 80, 443</span>

<span style="color: #6a6d6e;"># </span><span style="color: #6a6d6e;">on your computer/from repo</span>
<span style="color: #6a6d6e;"># </span><span style="color: #6a6d6e;">... add Procfile, then:</span>
git remote add dokku <span style="color: #007c00;">"dokku@$domain:$app_name"</span>
git push dokku main
</pre>
</div>

<p>
As soon as you run git push, dokku runs the Procfile! That&rsquo;s all there is to it.
</p>

<p>
links:
</p>
<ul class="org-ul">
<li><a href="https://dokku.com/docs/getting-started/installation/">dokku installation</a></li>
<li><a href="https://dokku.com/docs/deployment/application-deployment/">dokku deployment</a></li>
</ul>

<p>
edit: want SSL? <a href="https://dokku.com/docs/configuration/ssl/">docs</a>
</p>

<p>
on server:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #6a6d6e;"># </span><span style="color: #6a6d6e;">self signed cert option:</span>
dokku certs:generate <span style="color: #007c00;">"$app_name"</span> key
</pre>
</div>

<p>
or, <a href="https://github.com/dokku/dokku-letsencrypt">Let&rsquo;s Encrypt</a>:
</p>

<div class="org-src-container">
<pre class="src src-bash">dokku plugin:install https://github.com/dokku/dokku-letsencrypt.git
dokku letsencrypt:cron-job --add <span style="color: #6a6d6e;"># </span><span style="color: #6a6d6e;">&lt;- To enable auto-renew</span>

dokku letsencrypt:set <span style="color: #007c00;">"$app_name"</span> email your@email.tld
dokku letsencrypt:enable <span style="color: #007c00;">"$app_name"</span>
</pre>
</div>

<div class=separator> ∗ ∗ ∗ </div>

<p>
usecase:
</p>

<p>
The <a href="https://github.com/neeasade/ct.el">ct.el</a> readme needs a few hundred color images for it&rsquo;s documentation (colors
are visual!), so I setup a little clojure service to send back smol square svgs.
The entire source is below:
</p>

<p>
<code>./src/muffin/handler.clj</code>:
</p>
<div class="org-src-container">
<pre class="src src-clojure">
(<span style="color: #0065c8;">ns</span> <span style="color: #006e96;">muffin.handler</span>
  (<span style="color: #0065c8;">:require</span> [compojure.core <span style="color: #0065c8;">:refer</span> <span style="color: #0065c8;">:all</span>]
            [compojure.route <span style="color: #0065c8;">:as</span> route]
            [ring.util.response <span style="color: #0065c8;">:as</span> resp]
            [ring.middleware.defaults <span style="color: #0065c8;">:refer</span> [wrap-defaults site-defaults]]))

(<span style="color: #0065c8;">defn</span> <span style="color: #c6007f;">svg-response</span> [svg-content]
  (<span style="color: #0065c8;">-&gt;</span> (<span style="color: #006e96;">resp</span>/response svg-content)
      (<span style="color: #006e96;">resp</span>/content-type <span style="color: #007c00;">"image/svg+xml"</span>)
      (<span style="color: #006e96;">resp</span>/header <span style="color: #007c00;">"Cache-Control"</span> <span style="color: #007c00;">"public, max-age=31536000, immutable"</span>)))

(<span style="color: #0065c8;">defn</span> <span style="color: #c6007f;">color-block</span>
  ([color] (color-block color 16))
  ([color width]
   (<span style="color: #0065c8;">when</span> (re-matches #<span style="color: #007c00;">"[a-f0-9]{6}"</span> color)
     (format <span style="color: #007c00;">"&lt;svg xmlns='http://www.w3.org/2000/svg' width='%s' height='%s'&gt;</span>
<span style="color: #007c00;">  &lt;rect width='%s' height='%s' fill='#%s'/&gt;</span>
<span style="color: #007c00;">&lt;/svg&gt;"</span> width width width width color))))

(defroutes app-routes
  (GET <span style="color: #007c00;">"/"</span> [] <span style="color: #007c00;">"But why? -_-"</span>)
  (GET <span style="color: #007c00;">"/colorsquare/:color.svg"</span> [color] (svg-response (color-block color)))
  (<span style="color: #006e96;">route</span>/not-found <span style="color: #007c00;">"Not Found"</span>))

(<span style="color: #0065c8;">def</span> <span style="color: #c6007f;">app</span> (wrap-defaults app-routes site-defaults))
</pre>
</div>

<p>
<code>./project.clj</code>:
</p>
<div class="org-src-container">
<pre class="src src-clojure">(<span style="color: #0065c8;">defproject</span> muffin <span style="color: #007c00;">"0.1.0-SNAPSHOT"</span>
  <span style="color: #0065c8;">:min-lein-version</span> <span style="color: #007c00;">"2.0.0"</span>
  <span style="color: #0065c8;">:dependencies</span> [[<span style="color: #006e96;">org.clojure</span>/clojure <span style="color: #007c00;">"1.10.0"</span>]
                 [compojure <span style="color: #007c00;">"1.6.1"</span>]
                 [<span style="color: #006e96;">ring</span>/ring-defaults <span style="color: #007c00;">"0.3.2"</span>]]
  <span style="color: #0065c8;">:plugins</span> [[lein-ring <span style="color: #007c00;">"0.12.5"</span>]]
  <span style="color: #0065c8;">:ring</span> {<span style="color: #0065c8;">:handler</span> <span style="color: #006e96;">muffin.handler</span>/app}
  <span style="color: #0065c8;">:profiles</span> {<span style="color: #0065c8;">:dev</span> {<span style="color: #0065c8;">:dependencies</span> [[<span style="color: #006e96;">javax.servlet</span>/servlet-api <span style="color: #007c00;">"2.5"</span>]
                                  [<span style="color: #006e96;">ring</span>/ring-mock <span style="color: #007c00;">"0.3.2"</span>]]}})
</pre>
</div>

<p>
<code>./Procfile</code>:
</p>
<div class="org-src-container">
<pre class="src src-nil">web: lein ring server-headless
</pre>
</div>

<div class="org-center">
<p>
<img src="https://muffin.app.neeasade.net/colorsquare/4fa4e8.svg" alt="4fa4e8.svg" class="org-svg"> <img src="https://muffin.app.neeasade.net/colorsquare/914fe8.svg" alt="914fe8.svg" class="org-svg"> <img src="https://muffin.app.neeasade.net/colorsquare/e84fa4.svg" alt="e84fa4.svg" class="org-svg"> <img src="https://muffin.app.neeasade.net/colorsquare/e8914f.svg" alt="e8914f.svg" class="org-svg"> <img src="https://muffin.app.neeasade.net/colorsquare/a5e84f.svg" alt="a5e84f.svg" class="org-svg"> <img src="https://muffin.app.neeasade.net/colorsquare/4fe892.svg" alt="4fe892.svg" class="org-svg">
</p>
</div>

<footer>
    <div style="float: left">
         <a href='tag-slop.html'>newer: tag slop</a> 
    </div>
    <div style="text-align: right">
         <a href='enchiridion.html'>older: Enchiridion #51</a> 
    </div>
</footer>
<hr>
</main>
</body>
</html>
