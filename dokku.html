<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>dokku</title>
<meta name="generator" content="Org Mode" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
<meta property="og:title" content="dokku">
<meta property="og:description" content="">
<meta property="og:image" content="https://notes.neeasade.net/assets/img/backgrounds/newfeather.png">
<meta property="og:url" content="https://neeasade.net/dokku.html">
<meta property="description" content="">
<meta name="twitter:card" content="summary">
<script src="/assets/js/linktext.js" defer></script>
<script src="../published/assets/js/linktext.js" defer></script>
<script src="/assets/js/copy.js" defer></script>
<script src="../published/assets/js/copy.js" defer></script>
<script data-goatcounter="https://neeasade.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
<script src="//instant.page/5.1.0" type="module" integrity="sha384-by67kQnR+pyfy8yWP4kPO12fHKRLHZPfEsiSXR8u2IKcTdxD805MGUXBzVPnkLHw"></script>
<link rel='stylesheet' href='/assets/css/colors.css?sum=495589c982e6b68f1a8adabc54e44dda'>
<link rel='stylesheet' href='./assets/css/colors.css?sum=495589c982e6b68f1a8adabc54e44dda'>
<link rel='stylesheet' href='/assets/css/normalize.css?sum=112272e51c80ffe5bd01becd2ce7d656'>
<link rel='stylesheet' href='./assets/css/normalize.css?sum=112272e51c80ffe5bd01becd2ce7d656'>
<link rel='stylesheet' href='/assets/css/magick.css?sum=e67dc754cb3ed386e2529c61f1b67ed6'>
<link rel='stylesheet' href='./assets/css/magick.css?sum=e67dc754cb3ed386e2529c61f1b67ed6'>
<link rel='stylesheet' href='/assets/css/notes.css?sum=88774771739fafe5f844480bfa0e5f33'>
<link rel='stylesheet' href='./assets/css/notes.css?sum=88774771739fafe5f844480bfa0e5f33'>
</head>
<body>
<main id="content" class="content">
<header>
<div style="float: left">
    <a href='./index.html'>../notes</a>
</div>

<div style="float: right">
    
    <a href="https://raw.githubusercontent.com/neeasade/neeasade.github.io/source/posts/dokku.org">source</a>
</div>
<h1 class=title>
    <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
        <rect x="5" y="15" width="20" height="20" fill="none" stroke="#5a5a5a" stroke-width="2"/>
        <rect x="14" y="6" width="20" height="20" fill="none" stroke="#5a5a5a" stroke-width="2"/>
    </svg>
    dokku
    <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
        <rect x="5" y="15" width="20" height="20" fill="none" stroke="#5a5a5a" stroke-width="2"/>
        <rect x="14" y="6" width="20" height="20" fill="none" stroke="#5a5a5a" stroke-width="2"/>
    </svg>
</h1>
<div class="org-center">
<p>

</p>
</div>
<span class=pubinfo>
    Published 2025-07-22
</span>
<div class="posttags"> <a href='./tag-clojure.html'>#clojure</a> </div>
</header>
<hr>
<p>
<a href="https://dokku.com/">dokku</a> is a PaaS (&ldquo;platform as a service&rdquo; or heroku-like) I&rsquo;d heard about off and
on over the years, but awhile back I got the chance to use it and it <i>just
worked</i> so hard I completely forgot about it, even though it&rsquo;s been running for
a year.
</p>

<p>
It looks like I took notes at the time on the setup (on a debian box hosted on
vultr) - named the &ldquo;app&rdquo; muffin, after my cat:
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #0095ac;">domain</span>=app.neeasade.net
<span style="color: #0095ac;">app_name</span>=muffin

<span style="color: #8a8a8a;"># </span><span style="color: #8a8a8a;">on server</span>
wget -NP . https://dokku.com/install/v0.35.7/bootstrap.sh
sudo <span style="color: #0095ac;">DOKKU_TAG</span>=v0.35.7 bash bootstrap.sh
dokku domains:set-global <span style="color: #cb7000;">"$domain"</span>
cat ~/.ssh/authorized_keys | dokku ssh-keys:add admin
dokku apps:create <span style="color: #cb7000;">'$app_name'</span>
- open ports 80, 443

<span style="color: #8a8a8a;"># </span><span style="color: #8a8a8a;">on your computer/from repo</span>
<span style="color: #8a8a8a;"># </span><span style="color: #8a8a8a;">... add Procfile, then:</span>
git remote add dokku <span style="color: #cb7000;">"dokku@$domain:$app_name"</span>
git push dokku main
</pre>
</div>

<p>
As soon as you run git push, dokku runs the Procfile! That&rsquo;s all there is to it.
</p>

<p>
links:
</p>
<ul class="org-ul">
<li><a href="https://dokku.com/docs/getting-started/installation/">dokku installation</a></li>
<li><a href="https://dokku.com/docs/deployment/application-deployment/">dokku deployment</a></li>
</ul>

<div class=separator> ∗ ∗ ∗ </div>

<p>
usecase:
</p>

<p>
The <a href="https://github.com/neeasade/ct.el">ct.el</a> readme needs a few hundred color images for it&rsquo;s documentation (colors
are visual!), so I setup a little clojure service to send back smol square svgs.
The entire source is below:
</p>

<p>
<code>./src/muffin/handler.clj</code>:
</p>
<div class="org-src-container">
<pre class="src src-clojure">
(ns muffin.handler
  (:require [compojure.core :refer :all]
            [compojure.route :as route]
            [ring.util.response :as resp]
            [ring.middleware.defaults :refer [wrap-defaults site-defaults]]))

(defn svg-response [svg-content]
  (-&gt; (resp/response svg-content)
      (resp/content-type "image/svg+xml")
      (resp/header "Cache-Control" "public, max-age=31536000, immutable")))

(defn color-block
  ([color] (color-block color 16))
  ([color width]
   (when (re-matches #"[a-f0-9]{6}" color)
     (format "&lt;svg xmlns='http://www.w3.org/2000/svg' width='%s' height='%s'&gt;
  &lt;rect width='%s' height='%s' fill='#%s'/&gt;
&lt;/svg&gt;" width width width width color))))

(defroutes app-routes
  (GET "/" [] "But why? -_-")
  (GET "/colorsquare/:color.svg" [color] (svg-response (color-block color)))
  (route/not-found "Not Found"))

(def app (wrap-defaults app-routes site-defaults))
</pre>
</div>

<p>
<code>./project.clj</code>:
</p>
<div class="org-src-container">
<pre class="src src-clojure">(defproject muffin "0.1.0-SNAPSHOT"
  :min-lein-version "2.0.0"
  :dependencies [[org.clojure/clojure "1.10.0"]
                 [compojure "1.6.1"]
                 [ring/ring-defaults "0.3.2"]]
  :plugins [[lein-ring "0.12.5"]]
  :ring {:handler muffin.handler/app}
  :profiles {:dev {:dependencies [[javax.servlet/servlet-api "2.5"]
                                  [ring/ring-mock "0.3.2"]]}})
</pre>
</div>

<p>
<code>./Procfile</code>:
</p>
<div class="org-src-container">
<pre class="src src-nil">web: lein ring server-headless
</pre>
</div>

<p>
<img src="http://muffin.app.neeasade.net/colorsquare/4fa4e8.svg" alt="4fa4e8.svg" class="org-svg"> <img src="http://muffin.app.neeasade.net/colorsquare/914fe8.svg" alt="914fe8.svg" class="org-svg"> <img src="http://muffin.app.neeasade.net/colorsquare/e84fa4.svg" alt="e84fa4.svg" class="org-svg"> <img src="http://muffin.app.neeasade.net/colorsquare/e8914f.svg" alt="e8914f.svg" class="org-svg"> <img src="http://muffin.app.neeasade.net/colorsquare/a5e84f.svg" alt="a5e84f.svg" class="org-svg"> <img src="http://muffin.app.neeasade.net/colorsquare/4fe892.svg" alt="4fe892.svg" class="org-svg">
</p>

<footer>
    <div style="float: left">
         <a href='tag-slop.html'>newer: tag slop</a> 
    </div>
    <div style="text-align: right">
         <a href='enchiridion.html'>older: Enchiridion #51</a> 
    </div>
</footer>
<hr>
</main>
</body>
</html>
